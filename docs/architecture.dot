digraph AITilda {
    rankdir=TB;
    splines=ortho;
    node [fontname="Arial", fontsize=11];
    edge [fontname="Arial", fontsize=9];

    // Styling
    graph [bgcolor="white", pad="0.5"];

    // ===================
    // MAIN FLOW
    // ===================

    subgraph cluster_main {
        label="AI-Tilda v2.0 â€” Flow";
        style=rounded;
        bgcolor="#f8f9fa";
        fontsize=14;
        fontname="Arial Bold";

        // User
        User [
            label="ðŸ‘¤ ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ",
            shape=ellipse,
            style=filled,
            fillcolor="#e3f2fd",
            color="#1976d2"
        ];

        // Phase 1: Interview
        subgraph cluster_interview {
            label="Ð­Ð¢ÐÐŸ 1: Ð˜ÐÐ¢Ð•Ð Ð’Ð¬Ð®";
            style=rounded;
            bgcolor="#fff3e0";
            color="#ff9800";

            InterviewAPI [
                label="/api/interview\n(POST)",
                shape=box,
                style="filled,rounded",
                fillcolor="#ffe0b2"
            ];

            InterviewerAgent [
                label="Interviewer Agent\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\ninterviewer.ts",
                shape=box,
                style="filled,rounded",
                fillcolor="#ffcc80"
            ];

            AjtbdState [
                label="AJTBD State\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nâ€¢ productDescription\nâ€¢ targetAudience\nâ€¢ coreJob\nâ€¢ bigJob\nâ€¢ trigger\nâ€¢ pointA\nâ€¢ pointB\nâ€¢ barriers\nâ€¢ alternatives\nâ€¢ valueProposition",
                shape=note,
                style=filled,
                fillcolor="#fff8e1"
            ];
        }

        // Phase 2: Generation
        subgraph cluster_generate {
            label="Ð­Ð¢ÐÐŸ 2: Ð“Ð•ÐÐ•Ð ÐÐ¦Ð˜Ð¯";
            style=rounded;
            bgcolor="#e8f5e9";
            color="#4caf50";

            GenerateAPI [
                label="/api/generate\n(POST)",
                shape=box,
                style="filled,rounded",
                fillcolor="#c8e6c9"
            ];

            GeneratorAgent [
                label="Generator Agent\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\ngenerator.ts",
                shape=box,
                style="filled,rounded",
                fillcolor="#a5d6a7"
            ];

            LandingJSON [
                label="Landing JSON\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nâ€¢ settings\nâ€¢ blocks[ ]\n  - hero\n  - features\n  - problem\n  - how_it_works\n  - competitors\n  - cta",
                shape=note,
                style=filled,
                fillcolor="#f1f8e9"
            ];
        }

        // Phase 3: Preview & Edit
        subgraph cluster_edit {
            label="Ð­Ð¢ÐÐŸ 3: ÐŸÐ Ð•Ð’Ð¬Ð® + Ð Ð•Ð”ÐÐšÐ¢Ð˜Ð ÐžÐ’ÐÐÐ˜Ð•";
            style=rounded;
            bgcolor="#fce4ec";
            color="#e91e63";

            Preview [
                label="ðŸ–¥ï¸ ÐŸÑ€ÐµÐ²ÑŒÑŽ\nÐ›ÐµÐ½Ð´Ð¸Ð½Ð³Ð°",
                shape=box,
                style="filled,rounded",
                fillcolor="#f8bbd9"
            ];

            ChatAPI [
                label="/api/chat\n(POST)",
                shape=box,
                style="filled,rounded",
                fillcolor="#f48fb1"
            ];

            EditorAgent [
                label="Editor Agent\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\neditor.ts",
                shape=box,
                style="filled,rounded",
                fillcolor="#f06292"
            ];
        }

        // LLM
        LLM [
            label="ðŸ¤– LLM\n(claude-3.5-haiku)\nvia OpenRouter",
            shape=cylinder,
            style=filled,
            fillcolor="#e1bee7",
            color="#9c27b0"
        ];

        // Connections
        User -> InterviewAPI [label="ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ"];
        InterviewAPI -> InterviewerAgent;
        InterviewerAgent -> LLM [label="prompt"];
        LLM -> InterviewerAgent [label="response"];
        InterviewerAgent -> AjtbdState [label="stateUpdates"];
        AjtbdState -> User [label="nextMessage\n(loop until isComplete)"];

        AjtbdState -> GenerateAPI [label="isComplete: true", style=bold, color="#4caf50"];
        GenerateAPI -> GeneratorAgent;
        GeneratorAgent -> LLM [label="prompt"];
        LLM -> GeneratorAgent [label="response"];
        GeneratorAgent -> LandingJSON;

        LandingJSON -> Preview;
        Preview -> User [label="Ð¿Ð¾ÐºÐ°Ð·"];

        User -> ChatAPI [label="Ð·Ð°Ð¿Ñ€Ð¾Ñ Ð¿Ñ€Ð°Ð²ÐºÐ¸"];
        ChatAPI -> EditorAgent;
        EditorAgent -> LLM [label="prompt"];
        LLM -> EditorAgent [label="response"];
        EditorAgent -> LandingJSON [label="Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ"];
    }
}
